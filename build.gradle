plugins {
    id 'java'
    id 'maven-publish'
}

group = 'com.yourcompany.uac'
version = '0.1.0'

repositories {
    mavenCentral()
    maven {
        url = 'https://repo.papermc.io/repository/maven-public/'
    }
    maven {
        url = 'https://repo.dmulloy2.net/repository/public/'
    }
}

// Default to the bundled stub classes for offline CI, but allow real dependencies
// for production builds with -PusePublishedDependencies=true
boolean usePublishedDependencies = providers
        .gradleProperty("usePublishedDependencies")
        .map { it.toBoolean() }
        .orElse(false)
        .get()

dependencies {
    if (usePublishedDependencies) {
        compileOnly 'io.papermc.paper:paper-api:1.21.2-R0.1-SNAPSHOT'
        compileOnly 'com.comphenix.protocol:ProtocolLib:4.8.0'
        // Optional alternative packet library
        compileOnly 'io.github.retrooper.packetevents:packetevents-spigot:2.5.0'

        implementation 'org.slf4j:slf4j-api:2.0.6'
        runtimeOnly 'org.slf4j:slf4j-simple:2.0.6'

        implementation 'org.mongodb:mongodb-driver-sync:4.10.2'
    } else {
        logger.lifecycle('Using bundled stub APIs; pass -PusePublishedDependencies=true to resolve external libraries.')
    }
}

publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
        }
    }
}

java {
    // Prefer the installed JDK (21 in this environment) while still emitting Java 17 bytecode.
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }

    // Ensure the produced artifacts run on Java 17 runtimes without deprecated
    // convention-based configuration that was removed in Gradle 9.
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

tasks.withType(JavaCompile).configureEach {
    options.release = 17
}
